pool:
  vmImage: "Ubuntu 16.04"

steps:
  - script: echo "##vso[task.prependpath]$CONDA/bin"
    displayName: Add conda to PATH

  - script: conda create --yes --quiet --name uarray python=3.7
    displayName: Add conda to PATH

  - script: |
      source activate myEnvironment
      conda install -c xnd/label/dev gumath
      pip install -e .[all]
    displayName: Install package

  - script: |
      source activate myEnvironment
      pytest
    displayName: Run tests

  - task: PublishTestResults@2
    condition: always()
    inputs:
      testResultsFiles: "**/test-*.xml"
      testRunTitle: "Publish test results"

  - task: PublishCodeCoverageResults@1
    inputs:
      codeCoverageTool: Cobertura
      summaryFileLocation: "$(System.DefaultWorkingDirectory)/**/coverage.xml"
      reportDirectory: "$(System.DefaultWorkingDirectory)/**/htmlcov"
